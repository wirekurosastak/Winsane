<Window xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Winsane.UI.ViewModels"
             xmlns:views="using:Winsane.UI.Views"
             xmlns:cv="using:Winsane.UI.Converters"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="Winsane.UI.Views.MainWindow"
             x:DataType="vm:MainWindowViewModel"
             Title="Winsane"
             Width="1200" Height="800"
             MinWidth="900" MinHeight="600"
             WindowStartupLocation="CenterScreen"
             WindowState="Maximized"
             TransparencyLevelHint="Mica"
             Background="Transparent">

    <Window.Resources>
        <cv:IconSourceConverter x:Key="IconSourceConverter"/>
    </Window.Resources>

    <ui:NavigationView x:Name="NavView"
                       PaneDisplayMode="Left"
                       IsBackButtonVisible="False"
                       IsPaneToggleButtonVisible="True"
                       IsSettingsVisible="True"
                       OpenPaneLength="200"
                       ItemInvoked="NavView_ItemInvoked"
                       SelectionChanged="NavView_SelectionChanged"
                       MenuItemsSource="{Binding Features}">
        
        <ui:NavigationView.MenuItemTemplate>
            <DataTemplate x:DataType="vm:FeatureViewModel">
                <ui:NavigationViewItem Content="{Binding Name}"
                                       Tag="{Binding}"
                                       IconSource="{Binding Icon, Converter={StaticResource IconSourceConverter}}"/>
            </DataTemplate>
        </ui:NavigationView.MenuItemTemplate>

        <ui:NavigationView.Content>
            <Grid>
                <!-- Feature Content -->
                <ContentControl Content="{Binding SelectedFeature}"
                                IsVisible="{Binding !IsSettingsVisible}">
                    <ContentControl.ContentTemplate>
                        <DataTemplate x:DataType="vm:FeatureViewModel">
                            <Grid>
                                <!-- Dashboard View - only visible when IsDashboard is true -->
                                <views:DashboardView DataContext="{Binding Dashboard}"
                                                     IsVisible="{Binding $parent[Grid].((vm:FeatureViewModel)DataContext).IsDashboard}"/>
                                
                                <!-- Feature View - only visible when IsDashboard is false -->
                                <views:FeatureView DataContext="{Binding}"
                                                   IsVisible="{Binding !IsDashboard}"/>
                            </Grid>
                        </DataTemplate>
                    </ContentControl.ContentTemplate>
                </ContentControl>
                
                <!-- Settings View -->
                <views:SettingsView DataContext="{Binding SettingsViewModel}"
                                    IsVisible="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).IsSettingsVisible}"/>
            </Grid>
        </ui:NavigationView.Content>
</ui:NavigationView>
</Window>
