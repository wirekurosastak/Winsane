<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:Winsane.UI"
             xmlns:sty="using:FluentAvalonia.Styling"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             xmlns:vm="using:Winsane.UI.ViewModels"
             x:Class="Winsane.App"
             RequestedThemeVariant="{x:Null}">

    <Application.DataTemplates>
        <local:ViewLocator/>
    </Application.DataTemplates>

    <Application.Resources>
        <SolidColorBrush x:Key="ToggleSwitchFillOn" Color="{DynamicResource SystemAccentColor}" />
        <SolidColorBrush x:Key="ToggleSwitchFillOnPointerOver" Color="{DynamicResource SystemAccentColor}" />
        <SolidColorBrush x:Key="ToggleSwitchFillOnPressed" Color="{DynamicResource SystemAccentColor}" />
        
        <SolidColorBrush x:Key="AccentButtonBackground" Color="{DynamicResource SystemAccentColor}" />
        <SolidColorBrush x:Key="AccentButtonBackgroundPointerOver" Color="{DynamicResource SystemAccentColor}" />
        <SolidColorBrush x:Key="AccentButtonBackgroundPressed" Color="{DynamicResource SystemAccentColor}" />

        <!-- Shared Item Footer Template (Buttons/Toggles) -->
        <DataTemplate x:Key="ItemFooterTemplate" x:DataType="vm:ItemViewModel">
            <StackPanel Orientation="Horizontal" Spacing="12">
                 <!-- Status text -->
                <TextBlock Text="{Binding StatusText}"
                          VerticalAlignment="Center"
                          Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                          IsVisible="{Binding StatusText, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                
                <!-- Loading indicator -->
                <ui:ProgressRing IsIndeterminate="True"
                                Width="20" Height="20"
                                IsVisible="{Binding IsLoading}"/>
                
                <!-- Toggle Switch (only for items without buttons) -->
                <ToggleSwitch IsChecked="{Binding IsEnabled}"
                             IsVisible="{Binding ShowToggle}"
                             IsEnabled="{Binding !IsLoading}"
                             OnContent="{x:Null}"
                             OffContent="{x:Null}"/>
                
                <!-- Run/Open Button -->
                <Button Content="{Binding ButtonText}"
                       IsVisible="{Binding ShowRunButton}"
                       IsEnabled="{Binding !IsLoading}"
                       Command="{Binding ExecuteButtonCommand}"
                       Classes="accent"
                       Margin="0,0,7,0"/>
                
                <!-- Delete Button (for user tweaks) -->
                <Button Content="Delete"
                       IsVisible="{Binding ShowDeleteButton}"
                       IsEnabled="{Binding !IsLoading}"
                       Command="{Binding DeleteCommand}"
                       Foreground="#E74856"/>
            </StackPanel>
        </DataTemplate>

        <!-- Shared Item Leaf Template (Grid Layout) -->
        <DataTemplate x:Key="ItemLeafTemplate" x:DataType="vm:ItemViewModel">
           <Grid ColumnDefinitions="*,Auto" Margin="16,12">
                <StackPanel Grid.Column="0" VerticalAlignment="Center" Spacing="2">
                    <TextBlock Text="{Binding Name}" 
                               Theme="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="{Binding Purpose}" 
                               Theme="{StaticResource CaptionTextBlockStyle}" 
                               Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                               TextWrapping="Wrap"/>
                </StackPanel>
                
                <!-- Footer -->
                <ContentControl Grid.Column="1" 
                                VerticalAlignment="Center"
                                Content="{Binding}" 
                                ContentTemplate="{StaticResource ItemFooterTemplate}"
                                Margin="12,0,0,0"/>
           </Grid>
        </DataTemplate>
    </Application.Resources>
  
    <Application.Styles>
        <sty:FluentAvaloniaTheme PreferSystemTheme="True" />
        
        <!-- Force White text on Accent buttons (User Request) -->
        <Style Selector="Button.accent">
            <Setter Property="Foreground" Value="White" />
        </Style>
        <Style Selector="Button.accent /template/ ContentPresenter">
            <Setter Property="Foreground" Value="White" />
        </Style>
        <Style Selector="Button.accent:pointerover /template/ ContentPresenter">
            <Setter Property="Foreground" Value="White" />
        </Style>
        <Style Selector="Button.accent:pressed /template/ ContentPresenter">
            <Setter Property="Foreground" Value="White" />
        </Style>
    </Application.Styles>
</Application>